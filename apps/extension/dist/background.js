(()=>{"use strict";console.log("🚀 Referral Extension Background Script Loaded");const e={username:"testuser",walletAddress:"0x742d35Cc6635C0532925a3b8D2c2C5c5b2b4b3b3"};console.log("🚀 Test user data loaded:",e),chrome.runtime.onMessage.addListener((e,t,o)=>(console.log("📨 Message received from content script:",e),"ATTRIBUTION_DETECTED"===e.type&&(console.log("🎯 Attribution detected!",e.data),console.log("💰 Attribution data that would be sent to API:",{user:e.data.user,wallet:e.data.wallet,source:e.data.source,destination:e.data.destination,referralId:e.data.referralId,timestamp:e.data.timestamp,originalUrl:e.data.originalUrl,modifiedUrl:e.data.modifiedUrl}),chrome.storage.local.get(["attributions"],t=>{const o=t.attributions||[];o.push(e.data),chrome.storage.local.set({attributions:o},()=>{console.log("💾 Attribution stored locally"),console.log("📊 Total attributions:",o.length)})}),o({success:!0})),!0)),chrome.webRequest.onBeforeRequest.addListener(e=>((e.url.includes("utm_source=chatgpt.com")||e.url.includes("visioncenter.org")||e.url.includes("ref="))&&console.log("🌐 Interesting web request:",{url:e.url,method:e.method,type:e.type,tabId:e.tabId}),{}),{urls:["https://*/*","http://*/*"],types:["main_frame","sub_frame"]}),chrome.webRequest.onBeforeSendHeaders.addListener(e=>((e.url.includes("utm_source=chatgpt.com")||e.url.includes("visioncenter.org"))&&console.log("📤 Headers for request:",{url:e.url,headers:e.requestHeaders,tabId:e.tabId}),{}),{urls:["https://*/*","http://*/*"]},["requestHeaders"]),chrome.webRequest.onCompleted.addListener(e=>{(e.url.includes("utm_source=chatgpt.com")||e.url.includes("visioncenter.org")||e.url.includes("ref="))&&console.log("✅ Request completed:",{url:e.url,statusCode:e.statusCode,tabId:e.tabId})},{urls:["https://*/*","http://*/*"]}),chrome.tabs.onUpdated.addListener((e,t,o)=>{"complete"===t.status&&o.url?.includes("utm_source=chatgpt.com")&&console.log("🔗 ChatGPT attributed page loaded:",{tabId:e,url:o.url,title:o.title})}),chrome.tabs.onActivated.addListener(e=>{chrome.tabs.get(e.tabId,t=>{t.url?.includes("chatgpt.com")&&console.log("👁️ User switched to ChatGPT tab:",{tabId:e.tabId,url:t.url})})}),console.log("🧪 Running extension test..."),console.log("🧪 Chrome APIs available:",{runtime:!!chrome.runtime,storage:!!chrome.storage,tabs:!!chrome.tabs,webRequest:!!chrome.webRequest}),chrome.storage.local.set({user:e},()=>{console.log("💾 User data stored in extension storage")}),console.log("🚀 Background script setup complete")})();